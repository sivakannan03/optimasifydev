@{
    ViewBag.Title = "ProductMaster";
    Layout = "~/Views/Shared/MasterLayout.cshtml";
}

<h2>ProductMaster</h2>


<body>
    @using (Html.BeginForm(FormMethod.Post))
    {
        <div>
            <table border="0" style="width: 100%">
                <tr>
                    <td>
                        <!--JqGrid Starts-->
                        <table style="margin-top: 7px; width :100%" border="0">
                            <tr>
                                <td>
                                    <table id="ajaxGrid" style="width: 100%" border="0"></table>
                                    <div id="ajaxGridPager">
                                    </div>
                                </td>
                            </tr>
                        </table>
                        <!--Ends-->
                    </td>
                </tr>
            </table>
        </div>
    }
</body>

<script type="text/javascript">

    function validSpecial(objElement) {

        var re = /^[a-zA-Z0-9-/\s.:]*/gi;
        if (objElement.value.match(re) != objElement.value) {
            alert('No Special Characters Allowed');
            objElement.value = '';

            return false;
        }

    }

    jQuery(document).ready(function () {

        initGrid();
    });


    function initGrid() {
        jQuery("#ajaxGrid").jqGrid({
            url: '@Url.Action("GridDataProductMaster")' ,

            datatype: "json",
            jsonReader: { repeatitems: false, id: "PKID" },
            colNames: ['PKID', 'Product Group', 'Product Code', 'Product Name', 'Node Type', 'Metis Product', 'KDP', 'NodeType', 'Team', 'Status'],
            colModel: [
                     { name: 'PKID', index: 'PKID', align: 'left', hidden: true, editable: true },

                     {
                         name: 'GenName', index: 'GenName', align: 'left', editable: true, editrules: { edithidden: true, required: true }, edittype: 'select', editoptions: { dataUrl: '@Url.Action("GetProductGroup")' }, formoptions: {
                             size: 35,
                             elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;"
                         }, searchoptions: { sopt: ['eq', 'bw', 'ew', 'cn'] }, search: false
                     },

                    {
                        name: 'ProductCode', index: 'ProductCode', align: 'left', hidden: true, editable: true, editrules: { edithidden: true, required: false },
                        formoptions: { rowpos: 3, colpos: 1, elmprefix: "&nbsp;&nbsp;" }, search: false
                    },
                   {
                       name: 'ProductName', index: 'ProductName', align: 'left', hidden: false, editable: true, editrules: { edithidden: true, required: false },
                       formoptions: {rowpos: 3, colpos: 2, elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;" },
                       searchoptions: { sopt: ['eq', 'bw', 'ew', 'cn'] }, searchrules: { required: true }, search: true, editoptions: {
                             size: 35,maxlength: 30,
                             dataEvents: [
                                 {
                                     type: 'keyup', // blur
                                     fn: function (e) {
                                         validSpecial(this);
                                     }
                                 }
                             ]
                         }
                     },
                      {
                          name: 'NodeType', index: 'NodeType', align: 'left', hidden: true, editable: true, editrules: { edithidden: true, required: false }, edittype: 'select', editoptions: { dataUrl: '@Url.Action("GetNodeType")' },
                          formoptions: { rowpos: 4, colpos: 1, elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;" }, search: false
                      },
                      {
                           name: 'METISProductName', index: 'METISProductName', align: 'left', editable: true, editrules: { edithidden: true, required: true }, edittype: 'select', editoptions: { dataUrl: '@Url.Action("MetisProductName")' }, formoptions: {
                               size: 35,
                               elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;"
                           }, searchoptions: { sopt: ['eq', 'bw', 'ew', 'cn'] }, search: false
                       },
                     @*{
                         name: 'METISProductName', index: 'METISProductName', align: 'left', formoptions: {
                             size: 35,
                             elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;"
                         }, searchoptions: { sopt: ['eq', 'bw', 'ew', 'cn'] }, search: false, editable: true, editrules: { edithidden: true, required: true }, edittype: 'select', editoptions: { dataUrl: '@Url.Action("MetisProductName")' }
                     },*@
                     {
                         name: 'IsKDP', index: 'IsKDP', align: 'left', editable: true, editable: true,edittype: 'select', editoptions: { value: { 1: 'Yes', 0: 'No' } }, formoptions: {
                             size: 35,
                             elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;"
                         }, searchoptions: { sopt: ['eq', 'bw', 'ew', 'cn'] }, search: false, 
                     },

                         {
                             name: 'NodeType', index: 'NodeType', align: 'left', resizable: false, hidden: true, editable: true, edittype: 'select',
                             viewable: true, editrules: { edithidden: true, required: true }
                             , editoptions: {
                                 dataUrl: function () {
                                     var row_id = $('#ajaxGrid').getGridParam('selrow');
                                     return 'NodeProductLinkMaster?data=' + row_id;
                                 }
                             }, formoptions: {
                                 size: 35,
                                 elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;"
                             }, searchoptions: { sopt: ['eq', 'bw', 'ew', 'cn'] }, search: false
                         },
                           {
                               name: 'Team', index: 'Team', align: 'left', resizable: false, hidden: true, editable: true, edittype: 'select',
                               editrules: { edithidden: true, required: true }
                             , editoptions: {
                                 multiple: true, dataUrl: function () {
                                     var row_id = $('#ajaxGrid').getGridParam('selrow');
                                     return 'TeamProductlinkMaster?data=' + row_id;
                                 }
                             }, formoptions: {
                                 size: 35,
                                 elmprefix: "<span style='align:left;color:red'>*</span>&nbsp;"
                             }, searchoptions: { sopt: ['eq', 'bw', 'ew', 'cn'] }, search: false
                           },
                     {
                         name: 'IsActive', index: 'IsActive', align: 'left', resizable: false, editable: true, edittype: 'checkbox', editoptions: { value: "Active:Passive", defaultValue: "Active" }, formoptions: {
                             elmprefix: "&nbsp;&nbsp;&nbsp;"

                         }, search: false
                     },

            ],
            caption: "Product Master",
            autowidth: true,
            gridview: true,
            sortable: true,
            hidegrid: true,
            altRows: true,
            sortname: 'PKID',
            sortorder: 'desc',
            rowTotal: 10,
            rowNum: 10,
            gridComplete: function () {

                if (jQuery("#ajaxGrid").getGridParam("records") == 0) {
                    jQuery("#ajaxGrid").addRowData(
                    "blankRow", { "METISProductName": "No records to view" });
                }
            },
            viewrecords: true,
            pager: $('#ajaxGridPager'),
            height: 'auto',
            editable: true,
            editurl: '@Url.Action("EditProductMaster")'
        });


        jQuery("#ajaxGrid").jqGrid('navGrid', '#ajaxGridPager', { edit: true, add: true, del: true, search: true, view: true },
            {
                // Edit Portion
                closeOnEscape: true,
                width: 600,
                recreateForm: true,
                modal:true,
                checkOnSubmit: true,
                afterShowForm: function (form_id) {
                    var thisForm = form_id.selector.replace('FrmGrid_', 'editmod')
                    var dialogHeight = $(thisForm).height();
                    var dialogWidth = $(thisForm).width();
                    var windowHeight = $(window).height();
                    var windowWidth = $(window).width();
                    $(thisForm).css('position', 'fixed');
                    $(thisForm).css('top', ((windowHeight - dialogHeight) / 2));
                    $(thisForm).css('left', ((windowWidth - dialogWidth) / 2));
                },
                beforeShowForm: function (form) {
                    var sel_id = $('#ajaxGrid').jqGrid('getGridParam', 'selrow');
                    var value = $('#ajaxGrid').jqGrid('getCell', sel_id, 'IsActive');
                    $('#tr_IsActive', form).show();
                },
                afterSubmit: function (response, postdata) {

                    $("#ajaxGrid").jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    return [false, response.responseText];
                },
            },

        {
            //Add Portion
            closeOnEscape: true,
            closeAfterAdd: true,
            recreateForm: true,
            modal: true,
            width: 650,
            afterShowForm: function (form_id) {
                var thisForm = form_id.selector.replace('FrmGrid_', 'editmod');
                var dialogHeight = $(thisForm).height();
                var dialogWidth = $(thisForm).width();
                var windowHeight = $(window).height();
                var windowWidth = $(window).width();
                $(thisForm).css('position', 'fixed');
                $(thisForm).css('top', ((windowHeight - dialogHeight) / 2));
                $(thisForm).css('left', ((windowWidth - dialogWidth) / 2));
            },
            beforeShowForm: function (form) {
                $('#tr_IsActive', form).show();
            },
            afterSubmit: function (response, postdata) {

                if (response.responseText == "already Exists") {
                    return [false, response.responseText];
                }
                else {
                    $("#ajaxGrid").jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    return [false, response.responseText];
                }

            }
        },
        {
            //Delete
            closeOnEscape: true,
            recreateForm: true,
            modal: true,
            width: 450,
            beforeShowForm: function (form) {

                //POP UP Screen Fit Screen

                var thisForm = $("#delmod" + jQuery("#ajaxGrid")[0].id);
                var dialogHeight = $(thisForm).height();
                var dialogWidth = $(thisForm).width();
                var windowHeight = $(window).height();
                var windowWidth = $(window).width();
                $(thisForm).css('position', 'fixed');
                $(thisForm).css('top', ((windowHeight - dialogHeight) / 2));
                $(thisForm).css('left', ((windowWidth - dialogWidth) / 2));


                var col1 = $('#ajaxGrid').jqGrid('getGridParam', 'selrow');
                //var RegionCode = $('#ajaxGrid').jqGrid('getCell', col1, 'RegionCode');
                //var RegionName = $('#ajaxGrid').jqGrid('getCell', col1, 'RegionName');
                var Statusfield = $('#ajaxGrid').jqGrid('getCell', col1, 'IsActive');
                               
                $('tr td.delmsg').html('Delete selected record(s)?');
                // alert(IsActive);
                if (Statusfield == "Inactive") {
                    $('tr td.delmsg').html('Record Already Deleted');
                    $('#dData').hide();
                }
                else
                    $('#dData').show();

          


                //var html = "<form><table><tr><td class='CaptionTD'>Region Code</td><td class=='DataTD'>&nbsp;&nbsp;<input type='text' class='FormElement ui-widget-content ui-corner-all' readonly='true'  value='" + RegionCode + "'/></td> </tr>";
                //html += "<tr><td class='CaptionTD'>Region Name</td><td class=='DataTD'>&nbsp;&nbsp;<input type='text' class='FormElement ui-widget-content ui-corner-all' readonly='true'  value='" + RegionName + "'/></td></tr>";

                //if (IsActive == "Active")
                //    html += "<tr><td class='CaptionTD'>Status</td><td class=='DataTD'>&nbsp;&nbsp;<input class='FormElement ui-widget-content ui-corner-all'   type='checkbox' checked  disabled/></td>";
                //if (IsActive == "Inactive")
                //    html += "<tr><td class='CaptionTD'>Status</td><td class=='DataTD'>&nbsp;&nbsp; <input class='FormElement ui-widget-content ui-corner-all'   type='checkbox' disabled /></td></tr>";
                //html += "</table></form>";
                //$("td.delmsg", form[0]).html(html);


                //End POP UP Screen Fit Screen


            },
            afterSubmit: function (response, postdata) {
                $('tr td.delmsg').html('');
                $("#ajaxGrid").jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                $('#DelTbl_Productgroup td.ui-state-error').removeClass('ui-state-error').addClass('ui-state-highlight');
                return [false, response.responseText];
               
            }
        },
            {
                //Search

                closeOnEscape: true,
                modal: true,
                recreateForm: true,
                width: 600,
                caption: "Search",
                searchOnEnter: true,
                beforeShowSearch: function (form) {

                    $('#jqg1').val('');
                    $('#fbox_ajaxGrid_reset').click();

                    var dialogHeight = $("#searchmodfbox_ajaxGrid").height();
                    var dialogWidth = $("#searchmodfbox_ajaxGrid").width();
                    var windowHeight = $(window).height();
                    var windowWidth = $(window).width();
                    $("#searchmodfbox_ajaxGrid").css('position', 'fixed');
                    $("#searchmodfbox_ajaxGrid").css('top', ((windowHeight - dialogHeight) / 2));
                    $("#searchmodfbox_ajaxGrid").css('left', ((windowWidth - dialogWidth) / 2));

                    return [true, ""];
                }
            },
            {
                //View :
                closeOnEscape: true,
                modal: true,
                recreateForm: true,
                width: 600,

                beforeShowForm: function (form) {

                    var thisForm = $("#viewmod" + jQuery("#ajaxGrid")[0].id);
                    var dialogHeight = $(thisForm).height();
                    var dialogWidth = $(thisForm).width();
                    var windowHeight = $(window).height();
                    var windowWidth = $(window).width();
                    $(thisForm).css('position', 'fixed');
                    $(thisForm).css('top', ((windowHeight - dialogHeight) / 2));
                    $(thisForm).css('left', ((windowWidth - dialogWidth) / 2));
                }

            }
                );

    }

</script>